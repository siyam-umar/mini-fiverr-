<div class="container mt-4">
  <h1><%= @service.title %></h1>
  <p><strong>Description:</strong> <%= @service.description %></p>
  <p><strong>Price:</strong> $<%= @service.price %></p>

<% if @service.user == current_user %>
  <div class="d-flex gap-2 mb-3">
    <%= link_to "‚úèÔ∏è Edit", edit_service_path(@service), class: "btn btn-primary" %>

    <!-- Trigger button for modal -->
    <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteConfirmModal">
      üóëÔ∏è Delete
    </button>
  </div>
<% end %>


  <% if current_user.role == "client" %>
    <%= button_to "Order Now", service_orders_path(@service), method: :post, class: "btn btn-success mt-3" %>
  <% end %>

  <%= link_to "Back to Services", services_path, class: "btn btn-secondary mt-3" %>
</div>

<hr>

<%= turbo_stream_from [@service, :reviews] %>

<div id="<%= dom_id(@service, :rating_summary) %>">
  <%= render "reviews/rating_summary", service: @service %>
</div>

<% if user_signed_in? && current_user.role == "client" %>
  <div id="<%= dom_id(@service, :new_review_form) %>">
    <%= render "reviews/form", service: @service, review: Review.new %>
  </div>
<% end %>

<h3 class="mt-5">Reviews</h3>
<div id="<%= dom_id(@service, :reviews) %>">
  <%= render @service.reviews %>
</div>

<% if current_user != @service.user %>
  <%= form_with url: conversations_path, method: :post, local: true do %>
    <%= hidden_field_tag :receiver_id, @service.user.id %>
    <%= submit_tag "Message", class: "btn btn-outline-success" %>
  <% end %>
<% end %>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        ‚ö†Ô∏è Are you sure you want to delete this service?  
        <br> <strong>This action cannot be undone.</strong>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>

        <!-- REAL DELETE FORM -->
        <%= form_with url: service_path(@service), method: :delete do %>
          <%= submit_tag "Yes, Delete", class: "btn btn-danger" %>
        <% end %>
      </div>
    </div>
  </div>
</div>




